
> D() 

```{r}
D<-function(f,delta=.001) {
  fun=function(x){
  (f(x+delta)-f(x))/delta
  }
  return(fun)
}
f = function(x) {x*exp(-x^2)}
df = D(f)

x = seq(-1,3,length=1000)

plot(x,f(x),type='l',main="y = f(x)")
grid()
abline(0,0,col='blue')
abline(v=0,col='blue')
plot(x,df(x),type='l',main="dy/dx = f'(x)")
grid()
abline(0,0,col='blue')
abline(v=0,col='blue')
```


> Test

```{r}
library(Deriv)
df = Deriv(f)
x = seq(-1,3,length=1000)

plot(x,f(x),type='l',main="y = f(x)")
grid()
abline(0,0,col='blue')
abline(v=0,col='blue')
plot(x,df(x),type='l',main="dy/dx = f'(x)")
grid()
abline(0,0,col='blue')
abline(v=0,col='blue')
```

> Newton

```{r}
Newton=function(f,x,max.its=50){
  res=x
  df=D(f)
  while (max.its>0) {
    x<-x-f(x)/df(x)
    res=c(res,x)
    max.its<-max.its-1
  }
  return(res)
}
options(digits = 12)
f=function(x) (cos(x))^2+sin(x)-1
Newton(f,4.25)
```

> visualiztion

```{r}
f = function(x) {exp(x)}
df = D(f)

x = seq(-1,3,length=1000)

y<-f(x)  
d_point<-data.frame(x,y)

x0<-0
y0<-f(0) #（0, 1）
k<-df(x0) # slope
b<-y0-k*x0  # intersecpt

library(ggplot2) 
p<-ggplot(subset(d_point,y<=15),aes(x,y))+
  theme_classic()+
  theme(legend.position="none")
p+geom_line()+geom_abline(intercept=b, slope=k,linetype=2)+geom_point(data=data.frame(x=0,y=1),aes(colour="red"))
```

> Q3

```{r}
f = function(x) {exp(x)}

slopes=function(f,x){
  df=D(f,delta = 10^-(1:20))
  return(df(x))
}

options(digits = 20)
(slopes=slopes(f,0))  # slope should be 1
x=c(1:15)
plot(x,slopes[1:15])
(e=(slopes[1:15]-1))
plot(x,e)
min(e)

```

> $\delta=10^{-13 or 14}$ is most accurate

> Test for another function

```{r}
f = function(x) {x^2}

slopes=function(f,x){
  df=D(f,delta = 10^-(1:20))
  return(df(x))
}

options(digits = 20)
(slopes=slopes(f,1))  # slope should be 2
x=c(1:15)
plot(x,slopes[1:15])
(e=(slopes[1:15]-1))
plot(x,e)
min(e)
```

> Consistent
